# nginx性能为什么能够支持高并发

- nginx有一个主进程和多个工作进程，每个工作进程都可以同时处理数以千计的网络请求；
  - 好处是进程相互独立，不需要加锁，减少使用锁对性能的影响。

- 基于异步及非阻塞的事件驱动模型；
  - 好处是工作进程和客户端在响应等待期间可以处理其他请求，提高效率。



# nginx如何处理一个请求的

1. nginx启动时解析配置文件，得到监听的端口和地址，在master进程里边初始化监控socket，然后fork多个子进程；
2. 子进程竞争accept新的连接，此时客户端就可以向nginx发起http请求，通过三次握手建立连接；
3. 某个子进程accept连接成功，得到这个连接好的socket，然后创建nginx对应的封装，即nginx_connection_t结构体；
4. 设置读写事件处理函数并添加读写事件来与客户端进行数据交换；
5. nginx或客户端主动关闭连接，连接结束；





# nginx和apache的区别

apache是同步多进程模型，一个连接对应一个进程；

nginx是异步多进程模型，多个连接可以对应一个进程；



nginx比apache更轻量级，且在高并发下nginx消耗更小资源；nginx模块化设计，拥有众多的模块；



# nginx的负载均衡策略

1. 轮询：每个请求按照时间顺序依次分配到不同的后端服务器上，若后端服务器宕机则自动剔除；
2. ip哈希：每个请求按照ip的hash结果分配，这样每个访客将被分配到固定的后端服务器上，解决session共享问题；
3. 最小连接数：请求将被分配到连接数最少的后端服务器上；
4. 加权轮询、加权最小连接：后端服务器具有权重比例；



# nginx状态码499原因

服务器端处理时间过长，客户端主动关闭连接。